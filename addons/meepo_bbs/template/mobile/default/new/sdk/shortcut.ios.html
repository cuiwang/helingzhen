<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <title></title>
    <style>
    .sc-wrapper{
        margin: 0 20px;
        text-align: center;
        font-family: "Helvetica Neue",Helvetica,STHeiTi,sans-serif;
    }
    .sc-tribe-wrapper{
        border-bottom: 1px solid #efedf2;
    }
    .sc-avatar{
        margin: 79px auto 13px;
        width: 65px;
        height: 65px;
        border: 3px solid white;
        box-shadow: 1px 1px 1px rgba(0, 0, 0, 0.13),-1px 0 1px rgba(0, 0, 0, 0.13);

        background-size: 100%;

        border-radius: 10px;
    }
    .sc-avatar img{
        width: 100%;
        height: 100%;
        border-radius: 10px;
    }
    .sc-name{
        margin-bottom: 34px;
        font-size: 20px;
    }
    .sc-ios-title{
        margin-top: 34px;
        font-size: 14px;
        color: #767b8d;
    }
    .sc-ios-click-first{
        margin-top: 25px;
        font-size: 20px;
    }
    .sc-ios-desk{
        display: inline-block;
        width: 30px;
        height: 30px;
        background: center no-repeat url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8BAMAAADI0sRBAAAAG1BMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACUUeIgAAAACHRSTlMAApabhXLaGd/f37UAAAGvSURBVDjLpVO7bsMwDBT7QD0e0Q4eM/YTMmbM2Kl/0L2f4BgooM/uUVJKRVSBAmWcmOGZxztZSn8ItBvqzzTErruD3S2bxutOSEZYGv99zgeI4BcFx5x36xz42/PP+XXPByY6yCrsOO7Ldt7Bp8fxSvQ+n5btobQjtHPyV1q2dN7nrl/yW1o3POYTuyPB00cCu9P7Z8INiCYdhN2lhxAvt/WiDQJcNn1VH+yGYfNVd3KZql8uvA/crOYSG8nxk0fYyANcORWW1Kow0R4GWvVa2cQ1edUTe96rcm2qb3OAbxMB1Xism1i7osCucZjUOCXMdo1oFb3tBptQ/CAqLzVYE5JqmJ3EE+AWvtoALdS3P8Bb2zOrW4jkYlXL4uyhyVfN/7gfzLpFmQBecc5+O1N9gKHanZ01kIsf9pHcpKE795jMdoYJOTpqVL6OSqzopbBbDK/uJjAhDymLHxeVHP1ZjDolzvYt5s6XiTEpHzSxAS6m5919wCoSYDc+KL+gboekKnRnR9C7Zc0hOlgncH/GjBAgp6jw0nIWumAJxBOgaqOV384IEbUS61qk27P/jm/MGG6YaPU+lQAAAABJRU5ErkJggg==');
        background-size: 100% 100%;
        vertical-align: bottom;
    }
    .sc-ios-click-second{
        margin-top: 15px;
        font-size: 20px;
    }

    .sc-android-title{
        margin-top: 34px;
        font-size: 20px;
        text-align: left;
    }
    .sc-android-list{
        text-align: left;
        font-size: 20px;
    }
    .sc-android-note{
        text-align: left;
        font-size: 14px;
        color: #767b8d;
    }
    .sc-arrow{
        position: fixed;
        bottom: 15px;
        margin-left: -8px;
        width: 100%;
        height: 34px;
        background: center no-repeat url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADoAAABWCAMAAACpU3U7AAAAOVBMVEUAAAD/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR7/bR5reDV1AAAAEnRSTlMANfr18EB+TCW60+Z2FJ2BX1ci1Wx+AAAAy0lEQVRYw+3NORKDMBBEUSEvSIC3uf9hjUzQQRduRhHB/KRHwSul/UrNuZbUU7W12kVzo7mL2q+gQYMGDRo0aNCgQYOeiz7cdHiXNmWyefTRxSwv65ezrcfooXdrfdrCSgppNb0MVlNIe6ZygdUU8lpSusFqCjm0F6ygJMkS3ZdsmbJkS1RItqBCsgUVki2okGxBhWQLylJYUJLKgpKUFpSktKAktd0OkkfstiSP2G1YaiuktpBeC+m1kF4L6bWQXgvpt5BuO5lNf+QXaqI8oBMeoZcAAAAASUVORK5CYII=');
        background-size: 29px 34px;
        -webkit-animation: sc-arrow-anim 1.2s linear 0s infinite normal;
        animation: sc-arrow-anim 1.2s linear 0s infinite normal;
    }
    @-webkit-keyframes sc-arrow-anim {
        0% {
            bottom: 15px;
        }
        50% {
            bottom: 30px;
        }
        100% {
            bottom: 15px;
        }
    }
    @keyframes sc-arrow-anim {
        0% {
            bottom: 15px;
        }
        50% {
            bottom: 30px;
        }
        100% {
            bottom: 15px;
        }
    }
    </style>
</head>
<body>
<div class="sc-wrapper">
    <div class="sc-tribe-wrapper">
        <div class="sc-avatar" id="avatar"></div>
        <div class="sc-name" id="name"></div>
    </div>
    <div class="sc-ios-title">添加入口到主屏幕</div>
    <div class="sc-ios-click-first">
        点击<span class="sc-ios-desk"></span>
    </div>
    <div class="sc-ios-click-second">然后选择“添加到主屏幕”</div>
    <div class="sc-instruction-wrapper">
    </div>
</div>
<div class="sc-arrow"></div>

<script>
    ;(function () {

        function $ (id) {
            return document.getElementById(id) || null;
        }

        function hackXSS (s) {
            return String(s).replace(/</g, '&lt;')
                            .replace(/>/g, '&gt;')
                            .replace(/'/g, '&acute;')
                            .replace(/"/g, '&quot;');
        }

        function query(n) {
            var m = window.location.search.match(new RegExp("(?:\\?|&)" + n + "=([^&]*)(&|$)"));
            return !m ? "" : hackXSS(decodeURIComponent(m[1]));
        }
        function getHash(n) {
            var m = window.location.hash.match(new RegExp("(?:#|&)" + n + "=([^&]*)(&|$)"));
            return !m ? "" : hackXSS(decodeURIComponent(m[1]));
        }

        function updateUI () {
            $('avatar').style.backgroundImage = 'url('+ ICON +')';
            $('name').innerText = TITLE;
            $('avatar').addEventListener('touchstart', invoke)
        }
        
        function setTitle () {
            document.title = TITLE;
        }

        function setIcon () {
            ['', '72x72', '114x114', '144x144'].forEach(function (size) {

                var link = document.createElement('link');
                link.rel = 'apple-touch-icon';
                size && (link.sizes = size);
                link.href = ICON;
                document.getElementsByTagName('head').item(0).appendChild(link);

            });
        }


        function invoke () {
            var iframe = document.createElement('iframe');

            iframe.style.cssText = 'display:none;width:0px;height:0px;';

            /*
                ios 必须先赋值, 然后 append, 否者连续的 api调用会间隔着失败
                也就是 api1(); api2(); api3(); api4(); 的连续调用,
                只有 api1 和 api3 会真正调用到客户端
            */
            iframe.onload = function () {};
            iframe.src = 'mqqapi://forward/url?version=1&src_type=web&url_prefix=' + btoa(URL);

            (document.body || document.documentElement).appendChild(iframe);

            // android 捕获了iframe的url之后, 也是中断 js 进程的, 所以这里可以用个 setTimeout 0 来删除 iframe
            setTimeout(function() {
                iframe.parentNode.removeChild(iframe);
            }, 0);
        }

        var TITLE = query('title');
        var URL = query('url');
        var ICON = query('icon');
        var FROM = getHash('from');

        updateUI();
        setTitle();
        setIcon();

        if( FROM === 'mqq' ) {
            window.location.hash = '';
        } else {
            invoke()
        }

    })();
</script>
</body>
</html>
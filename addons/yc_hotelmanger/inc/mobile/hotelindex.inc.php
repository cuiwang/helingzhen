<?php/* * To change this license header, choose License Headers in Project Properties. * To change this template file, choose Tools | Templates * and open the template in the editor. */global $_GPC;global $_W;if (!$this->is_weixin()) {    message('请在微信中打开');}$hotelid = intval($_GPC['hotelid']);$level = $this->hotel_level;$list = array();$hotel = pdo_fetch('SELECT * FROM ' . tablename($this->hotel) . 'WHERE id=' . $hotelid . ' and status = 1 and uniacid =' . $this->_weid);$hotel['level'] = $level[$hotel['level']];$hotel['thumbs_count'] = count(iunserializer($hotel['thumbs'])) + 1;$time = time();$hotel['time'] = date('Y-m-d', $time);$hotel['k'] = date('Y-m-d', $time);$mtime = strtotime(date('Y-m-d', strtotime('+1 day')));$hotel['mtime'] = date('Y-m-d', $mtime);$hotel['m'] = date('Y-m-d', $mtime);$room = pdo_fetchall('SELECT * FROM ' . tablename($this->room) . ' WHERE uniacid =' . $this->_weid . ' and status = 1 and  hotelid =' . $hotel['id']);$devices = iunserializer($hotel['show_device']);foreach ($room as $k => $val) {    $sql = 'SELECT count(*) as total FROM ' . tablename($this->order) . ' WHERE uniacid = ' . $this->_weid . ' and hotelid =' . $val['hotelid'] . ' and roomid =' . $val['id'] . ' and order_status !=4 and order_status !=5 and order_status !=6 and sintdate <=' . $time . ' and soutdate >=' . $mtime;  //  echo $sql;    $order_coune = pdo_fetch($sql);   // print_r($order_coune);    $room[$k]['ordercount'] = $order_coune['total'];  //  $momy = pdo_fetchall('SELECT * FROM ' . tablename($this->momy) . 'WHERE uniacid=' . $this->_weid . ' and status=1 and hotelid =' . $val['hotelid'] . ' and roomid =' . $val['id']); //   $room[$k]['momy'] = $momy;//    $copicr = pdo_fetch('SELECT cprice FROM ' . tablename($this->momy) . 'WHERE uniacid=' . $this->_weid . ' and status=1 and hotelid =' . $val['hotelid'] . ' and roomid =' . $val['id'] . ' ORDER BY cprice ASC ');    //$room[$k]['ccprice'] = $copicr['cprice'];    $room[$k]['ccprice'] = $room[$k]['mprice'];}require_once IA_ROOT . "/addons/yc_hotelmanger/jssdk.php";$signPackage = getSignPackage($_W['uniacid'], array("appsecret" => $_W['account']['secret'], "appid" => $_W['account']['key'])); load()->model("mc");     $uid= mc_openid2uid($this->openid);    if(!$uid){        $uid=$_W['fans']['uid'];    }        $userjf= pdo_fetch('SELECT uid,credit3 FROM ' . tablename($this->members) . ' WHERE uniacid = ' . $this->_weid . ' and uid= '.$uid);    $levelt=pdo_fetchall('SELECT levelname,ordercount,discount FROM ' . tablename($this->mlevel) . ' WHERE uniacid = ' . $this->_weid .' ORDER BY ordercount DESC');     $zk='';    foreach ($levelt as $key => $level) {        if($level['ordercount']>$userjf['credit3']){            continue;        }else{            $zk= $level['discount'];            break;        }    } $zk=$zk==0?1:$zk;$point = pdo_fetch( 'SELECT round(avg(point),1) point, count(*) count FROM ' . tablename($this->hotelComment) . ' where  uniacid=' . $this->_weid . ' and hotelid = ' .$hotelid);include $this->template('hotelindex');
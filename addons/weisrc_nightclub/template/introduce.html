{template 'common/header'}
<style>
     .item_box img{
         width: 100%;
         height: 100%;
     }
</style>
<div class="main">
    <style type='text/css'>
        .tab-pane { padding:20px 0 20px 0;}
    </style>
	<form action="" method="post" class="form-horizontal form" enctype="multipart/form-data">
	<input type="hidden" name="id" value="{$setting['id']}" />
        <div class="panel panel-default">
            <div class="panel-heading">
                夜店信息
            </div>
            <div class="panel-body">
                <ul class="nav nav-tabs" id="myTab">
                    <li class="active"><a href="#tab_basic">夜店介绍</a></li>
                    <li><a href="#tab_winerule">存酒规则</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane  active" id="tab_basic">
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">夜店名称</label>
                            <div class="col-sm-9">
                                <input type="text" name="title" value="{$item['title']}" id="title" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">顶部图片</label>
                            <div class="col-sm-9">
                                {php echo tpl_form_field_image('logo', $logo, '', array('width' => 765, 'height' => 300))}
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">夜店简介</label>
                            <div class="col-sm-9">
                                <textarea style="height:100px;" name="info" id="info" class="form-control" cols="60" rows="2">{$item['info']}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">夜店介绍</label>
                            <div class="col-sm-9">
                                <textarea style="height:200px;" class="form-control richtext" name="content" cols="70" id="reply-add-text">{$item['content']}</textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">营业时间</label>
                            <div class="col-sm-9">
                                <input type="text" name="hours" value="{if empty($item)}9:00 ~ 22:00{else}{$item['hours']}{/if}" id="hours" class="form-control" />
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">联系人</label>
                            <div class="col-sm-9">
                                <input type="text" name="contact" id="contact" value="{$item['contact']}" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">电话</label>
                            <div class="col-sm-9">
                                <input type="text" name="tel" id="tel" value="{$item['tel']}" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">人均消费</label>
                            <div class="col-sm-9">
                                <input type="text" name="consume" id="consume" value="{$item['consume']}" class="form-control">
                                <div class="help-block">在首页展示</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">店内WIFI</label>
                            <div class="col-sm-9">
                                <input type="text" name="wifi" id="wifi" value="{$item['wifi']}" class="form-control">
                                <div class="help-block">在首页展示</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">商家所在地区</label>
                            <div class="col-sm-3">
                                <select name="location_p" id="location_p" class="location form-control"></select>
                            </div>
                            <div class="col-sm-3">
                                <select name="location_c" id="location_c" class="location form-control"></select>
                            </div>
                            <div class="col-sm-3">
                                <select name="location_a" id="location_a" class="location form-control"></select>
                                <script type="text/javascript" src="../addons/weisrc_nightclub/template/js/region_select.js"></script>
                                <script type="text/javascript">
                                    var location_p = "{if !empty($item['location_p'])}{$item['location_p']}{else}广东省{/if}";
                                    var location_c = "{if !empty($item['location_c'])}{$item['location_c']}{else}汕头市{/if}";
                                    var location_a = "{if !empty($item['location_a'])}{$item['location_a']}{else}龙湖区{/if}";
                                    new PCAS("location_p", "location_c", "location_a", location_p, location_c, location_a);
                                </script>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">地址</label>
                            <div class="col-sm-9">
                                <input type="text" name="address" id="address" value="{$item['address']}" class="form-control" >
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">经纬度</label>
                            <div class="col-sm-9">
                                <div class="input-append">
                                    <input type="text" id="place" class="input-xlarge valid form-control" name="place" value="汕头市龙湖区长平路127号" data-rule-required="true" style="width:200px;display: inline;">
                                    <button class="btn" type="button" id="positioning" onclick="bmap.searchMapByAddress($('#place').val())">搜索</button>
                                </div>
                                <span class="maroon" style="color: #f30;margin-left: 5px;">注意：这个只是模糊定位，准确位置请地图上标注!</span>
                                <div id="l-map" style="overflow: hidden; position: relative; z-index: 0; background-image: url(http://api.map.baidu.com/images/bg.png);width: 500px; height: 300px;margin-top: 10px; color: rgb(0, 0, 0); text-align: left;"></div>
                                <div id="r-result">
                                    <input type="text" id="lat" name="lat" class="form-control" style="width:200px;display: inline;"> <input type="text" id="lng" name="lng" class="form-control" style="width:200px;display: inline;">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="tab_winerule">
                        <div class="form-group">
                            <label class="col-xs-12 col-sm-3 col-md-2 control-label">存酒介绍</label>
                            <div class="col-sm-9">
                                <textarea name="savewinerule" class="richtext form-control" style="height: 50px;">{if empty($item)}<p>
                                    1. 公司一律不设软饮存放；&nbsp;<br style="white-space: normal;"/>2. 洋酒剩下不足整支20%啤酒不足半打不设存放；&nbsp;<br style="white-space: normal;"/>3. 房间：红酒/香槟/洋酒存放有效期30天，啤酒存放有效期15天；&nbsp;<br style="white-space: normal;"/>4. 大厅：红酒有效期15天，啤酒有效期7天；&nbsp;<br style="white-space: normal;"/>5. 周五周六节假日公司派对不得取存酒；&nbsp;<br style="white-space: normal;"/>6. 大厅酒水一律不许带人包房，包房可带入大厅消费；&nbsp;<br style="white-space: normal;"/>7. 本公司拥有最终解释权；
                                </p>{else}{$item['savewinerule']}{/if}
                                </textarea>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group col-sm-12">
            <input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
            <input type="hidden" name="token" value="{$_W['token']}" />
        </div>
	</form>
</div>
<script language='javascript'>
    require(['jquery', 'util'], function ($, u) {
        $(function () {
            u.editor($('.richtext')[0]);
            u.editor($('.richtext')[1]);
        });
    });
</script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=1.4"></script>
<script type="text/javascript" src="http://api.map.baidu.com/getscript?v=1.4&ak=&services=&t=20140102035142"></script>
<script type="text/javascript">
    $(function(){
        $(".location").change(function(){
            bmap.searchMapByPCD();
        });
    });
    new PCAS("location_p", "location_c", "location_a", location_p, location_c, location_a);
    var bmap = {
        'option' : {
            'lock' : false,
            'container' : 'l-map',
            'infoWindow' : {'width' : 250, 'height' : 100, 'title' : ''},
            'point' : {'lng' : "{if $setting['lng']!='0.0000000000' && !empty($setting['lng'])}{$setting['lng']}{else}116.735049{/if}", 'lat' : "{if $setting['lat']!='0.0000000000' && !empty($setting['lat'])}{$setting['lat']}{else}23.367896{/if}"}
        },
        'init' : function(option) {
            var $this = this;
            $this.option = $.extend({},$this.option,option);

            $this.option.defaultPoint = new BMap.Point($this.option.point.lng, $this.option.point.lat);
            $this.bgeo = new BMap.Geocoder();
            $this.bmap = new BMap.Map($this.option.container);
            $this.bmap.centerAndZoom($this.option.defaultPoint, 15);
            $this.bmap.enableScrollWheelZoom();
            $this.bmap.enableDragging();
            $this.bmap.enableContinuousZoom();
            $this.bmap.addControl(new BMap.NavigationControl());
            $this.bmap.addControl(new BMap.OverviewMapControl());
            //添加标注
            $this.marker = new BMap.Marker($this.option.defaultPoint);
            $this.marker.setLabel(new BMap.Label('请您移动此标记，选择您的坐标！', {'offset':new BMap.Size(10,-20)}));
            $this.marker.enableDragging();
            $this.bmap.addOverlay($this.marker);
            //$this.marker.setAnimation(BMAP_ANIMATION_BOUNCE);
            $this.showPointValue($this.marker.getPosition());
            //拖动地图事件
            $this.bmap.addEventListener("dragging", function() {
                $this.setMarkerCenter();
                $this.option.lock = false;
            });
            //缩入地图事件
            $this.bmap.addEventListener("zoomend", function() {
                $this.setMarkerCenter();
                $this.option.lock = false;
            });
            //拖动标记事件
            $this.marker.addEventListener("dragend", function (e) {
                $this.showPointValue();
                $this.showAddress();
                $this.bmap.panTo(new BMap.Point(e.point.lng, e.point.lat));
                $this.option.lock = false;
                $this.marker.setAnimation(null);
            });
        },
        'searchMapByAddress' : function(address) {
            var $this = this;
            $this.bgeo.getPoint(address, function (point) {
                if (point) {
                    $this.showPointValue();
                    $this.showAddress();
                    $this.bmap.panTo(point);
                    $this.setMarkerCenter();
                }
            });
        },
        'searchMapByPCD' : function(address) {
            //alert($('#location_p').val()+$('#location_c').val()+$('#location_a').val());
            var $this = this;
            $this.option.lock = true;
            $this.searchMapByAddress($('#location_p').val()+$('#location_c').val()+$('#location_a').val());
        },
        'setMarkerCenter' : function() {
            var $this = this;
            var center = $this.bmap.getCenter();
            $this.marker.setPosition(new BMap.Point(center.lng, center.lat));
            $this.showPointValue();
            $this.showAddress();
        },
        'showPointValue' : function() {
            var $this = this;
            var point = $this.marker.getPosition();
            $('#lng').val(point.lng);
            $('#lat').val(point.lat);
        },
        'showAddress' : function() {
            var $this = this;
            var point = $this.marker.getPosition();
            $this.bgeo.getLocation(point, function (s) {
                if (s) {
                    $('#place').val(s.address);
                    if (!$this.option.lock) {
                        new PCAS("location_p", "location_c", "location_a", s.addressComponents.province, s.addressComponents.city, s.addressComponents.district);
                    }
                }
            });
        }
    };
    $(function(){
        var option = {};
        bmap.init(option);
    });</script>

<script type="text/javascript">
    $(function () {
        window.optionchanged = false;
        $('#myTab a').click(function (e) {
            e.preventDefault();//阻止a链接的跳转行为
            $(this).tab('show');//显示当前选中的链接及关联的content
        })
    });
</script>
{template 'common/footer'}
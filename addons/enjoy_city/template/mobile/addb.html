{template 'header'}

<script type="text/javascript" src="http://api.map.baidu.com/api?ak=qen1OGw9ddzoDQrTX35gote2&v=2.0&services=false"></script>
   <script type="text/javascript">
   var locationx='{$firm[location_x]}';
   var locationy='{$firm[location_y]}';
  if (locationy==0 ||locationx==0){
	   window.onload=distance;
  }
 

    function distance(){
        var geolocation = new BMap.Geolocation();
        geolocation.getCurrentPosition(function(r){
            if(this.getStatus() == BMAP_STATUS_SUCCESS){
                var position = {
                     lng: r.point.lng,
                     lat: r.point.lat,
                }
                positions(position);
            }else {
                alert('获取当前位置失败,请确定您开启了定位服务');
            }
        },{enableHighAccuracy: true});
    }
    function positions(position){
 //   alert(position.lng);
    //	alert(position.lat);
      //  window.location.href = "{php echo $_W['siteroot'].'app/'.substr($this->createMobileUrl('hs_list'),2)}" + '&lng=' + position.lng + '&lat=' + position.lat;
 $("#lng").val(position.lng);
 $("#lat").val(position.lat);
    }
  //  {if empty($user['lat']) || empty($user['lng'])}
    
  //  {/if}
  
    </script> 
<link rel="stylesheet" href="../addons/enjoy_city/public/css/_v1_shop_edit.css">
<header class="mui-bar mui-bar-nav">
<a class="mui-icon mui-icon-left-nav mui-pull-left mui-action-back" href="javascript:history.go(-1)"></a>
<h1 class="mui-title">编辑商户</h1></header><style></style>
<form class="mui-content large-form" data-api="shop_edit" method="post" data-valid="1" data-enterfocus="input,textarea" data-call="shopCallback" id="shop-edit">
{if $firm[ischeck]==1&&$act[issmple]==1||$act[issmple]==0}
<div class="mui-input-group mui-content-padded ">
<h2 class="user-title">微友圈信息</h2>
<div class="form-text" id="wx-tip"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear" name="wei_num" placeholder="老板微信号" id="wei_num" value="{$firm['wei_num']}" data-valid="^[^\s]{2,}$" required="" data-input-clear="1"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text" id="name-tip"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear" name="wei_name" placeholder="老板微信昵称" id="wei_name" value="{$firm['wei_name']}" data-valid="^[^\s]{2,}$" required="" data-input-clear="2"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text" id="sex-tip"></div>
<div class="mui-input-row mui-radio">
<label>英俊帅气男老板</label>
<input type="radio" name="wei_sex" value="1" id="wei_sex" data-valid="^(true|false)$" {if $firm[wei_sex]==1}checked="checked"{/if} required="">
</div>
<div class="mui-input-row mui-radio">
<label>温柔美丽女老板</label>
<input type="radio" name="wei_sex" value="0" id="wei_sex" data-valid="^(true|false)$" {if $firm[wei_sex]==0}checked="checked"{/if} required="">
</div>
<div class="form-text" id="wechatdesc-tip"></div>
<div class="mui-input-row">
<input type="text" class=" mui-input-clear" name="wei_intro" placeholder="老板个人一句话介绍" id="wei_intro" data-valid="^.{10,}$" data-error="请输入十个字以上的介绍" required="" value="{$firm[wei_intro]}" data-input-clear="5"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>


<div class="mui-clearfix"></div>
<div class="mui-input-row">
<div class="upload-img mui-pull-left">
<img id="boss" class="crop-row" {if empty($firm[wei_avatar])}style="display: none"{else} 
src="{php echo tomedia($firm['wei_avatar'])}"{/if}>
<!-- <div class="close" data-type="wechat" data-id="  " data-field="boss">×</div>-->
</div>
<div class="mui-pull-right text-gray" data-upload="boss" data-field="wechat" data-id="  " data-aspectratio="1" data-minwidth="150" data-minheight="150">
选择老板头像(150x150)
<span class="mui-btn add-img">+</span>
</div>
<div class="mui-clearfix"></div>
</div>




<div class="mui-input-row">
<div class="upload-img mui-pull-left">
<img id="bossqr" class="crop-row" {if empty($firm[wei_ewm])}style="display: none"{else} 
src="{php echo tomedia($firm['wei_ewm'])}"{/if}>
<!--  <div class="close" data-type="wechat" data-id="" data-field="boss">×</div>-->
</div>
<div class="mui-pull-right text-gray" data-upload="bossqr" data-field="wechat" data-id="  " data-aspectratio="1" data-minwidth="200" data-minheight="200">
选择老板二维码(200x200)
<span class="mui-btn add-img">+</span>
</div>
</div>
</div>
{/if}
<h2 class="user-title">商户名称和简介</h2>
<div class="mui-input-group mui-content-padded">
<div class="form-text" id="childid-tip"></div>
<div class="form-text" id="catid-tip"></div>
<button id="catPicker" class="mui-btn mui-btn-block" type="button">请选择商户分类</button>
<input type="hidden" value="" name="shop[child_id]" id="childid" data-valid="^[1-9]\d*?$" required="">
<input type="hidden" value="" name="shop[cat_id]" id="catid" data-valid="^[1-9]\d*?$" required="">
<div class="form-text" id="company-tip"></div>
<div class="mui-input-row">
<input type="text" class="form-control form-control-middle" value="{$firm[title]}" id="title" name="title" placeholder="商户名称（必填、显示用）" data-valid="^.{2,}$" required="">
</div>
<div class="form-text" id="realname-tip"></div>
<div class="mui-input-row">
<input type="text" class=" mui-input-clear" id="s_name" value="{$firm[s_name]}" name="s_name" placeholder="申请人姓名（必填）" data-valid="^.{2,}$" required="" data-input-clear="7"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text" id="phone-tip"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear " id="tel" value="{$firm[tel]}" name="tel" placeholder="电话号码（必填、固话请加区号）" data-valid="^\d{7,12}$" onblur="this.value=this.value.replace(/\D/, &#39;&#39;)" maxlength="13" required="" data-input-clear="8"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
{if $firm[ischeck]==1&&$act[issmple]==1||$act[issmple]==0}
<div class="form-text"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear " id="breaks" value="{$firm[breaks]}" name="breaks" placeholder="请填写优惠信息（如全场八折）" data-valid="^\d{7,12}$" ><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear " id="custom" value="{$firm[custom]}" name="custom" placeholder="请填写自定义按钮（如：更多商品）" data-valid="^\d{7,12}$" ><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text"></div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear " id="firmurl" value="{$firm[firmurl]}" name="firmurl" placeholder="请填写自定义按钮外链（没有可以不填写）" data-valid="^\d{7,12}$" ><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text" id="intro-tip">支持粘贴优酷、土豆视频地址</div>
<textarea style="margin:15px 15px 0 13px;width:80%;" onfocus="$(this).css(&#39;height&#39;, &#39;200px&#39;)" onblur="$(this).css(&#39;height&#39;, &#39;80px&#39;)" id="intro" name="intro" placeholder="商户简介：非常重要！请您尽量把产品或服务相关的关键词填在简介中，以方便用户搜索查阅" data-valid="^[\s\S]{5,}$" required>
{php echo htmlspecialchars_decode($firm[intro])}
</textarea>
<!-- <div class="mui-input-group mui-content-padded">


 <input type="text" class="form-control form-control-middle" value="" name="shop_field[verify]" id="verify" placeholder="请填业务员姓名或理由「选填」">
-->

<!-- <button type="submit" class="mui-btn mui-btn-primary mui-btn-block">确认</button></div> -->

<div class="mui-input-row">
<div class="upload-img mui-pull-left">
<img id="shopicon" class="crop-row" {if empty($firm[icon])}style="display: none"{else} 
src="{php echo tomedia($firm['icon'])}"{/if}>
<!--  <div class="close" data-type="shop" data-id="" data-field="shopicon">×</div>-->
</div>
<div class="mui-pull-right text-gray" data-upload="shopicon" data-field="shop" data-id="" data-aspectratio="1" data-minwidth="180" data-minheight="180">选择商户图标(180x180)
<span class="mui-btn add-img">+</span>
</div>
</div>
<div class="mui-input-row">
<div class="upload-img mui-pull-left">
<img id="shopbanner" class="crop-row shopbanner" {if empty($firm[img])}style="display: none"{else} 
src="{php echo tomedia($firm['img'])}"{/if}>
<!-- <div class="close" data-type="shop" data-id="" data-field="shopbanner">×</div>-->
</div>
<div class="mui-pull-right text-gray" data-upload="shopbanner" data-field="shop" data-id="111394" data-aspectratio="NaN" data-maxwidth="900" data-maxheight="300" data-minwidth="600" data-minheight="200">
选择展示图片(600x300)
<span class="mui-btn add-img">+</span>
</div>
</div>
{/if}
</div>

<input type="hidden" name="wei_avatar" id="boss1" value="{$firm[wei_avatar]}"/>
<input type="hidden" name="wei_ewm" id="bossqr1" value="{$firm[wei_ewm]}"/>
<input type="hidden" name="icon" id="shopicon1" value="{$firm[icon]}"/>
<input type="hidden" name="img" id="shopbanner1" value="{$firm[img]}"/>
<input type="hidden" name="fid" id="fid" value="{$firm[id]}"/>
<input type="hidden" name="uid" id="uid" value="{if empty($firm[uid])}{$uid}{else}{$firm[uid]}{/if}"/>
<input type="hidden" name="ischeck" id="ischeck" value="{$firm[ischeck]}"/>
<input type="hidden" name="ismoney" id="ismoney" value="{$firm[ismoney]}"/>
<h2 class="user-title">地址信息</h2>
<div class="mui-input-group mui-content-padded">
<div class="form-text" id="province-tip"></div>
<div class="form-text" id="city-tip"></div>
<div class="form-text" id="country-tip"></div>
<button id="addressPicker" class="mui-btn mui-btn-block" type="button">请选择地址</button>
<input type="hidden" name="shop[province]" id="province" value="{if empty($firm['province'])}{$act['province']}{else}{$firm['province']}{/if}" data-valid="^.+$" required="">
<input type="hidden" name="shop[city]" id="city" value="{if empty($firm['city'])}{$act['city']}{else}{$firm['city']}{/if}" data-valid="^.+$" required="">
<input type="hidden" name="shop[country]" id="country" value="{if empty($firm['district'])}{$act['district']}{else}{$firm['district']}{/if}" data-valid="^.+$" required="">
<input type="hidden" name="shop[lat]" id="lat" value="{$firm[location_y]}" data-valid="^[\d\.]+$" data-error="地图经度定位出错" required="{$firm[loaction_x]}">
<input type="hidden" name="shop[lng]" id="lng" value="{$firm[location_x]}" data-valid="^[\d\.]+$" data-error="地图纬度定位出错" required="{$firm[loaction_y]}">
<div class="form-text" id="address-tip"></div>
<div class="mui-input-row" style="position:relative">
<input type="text" class="form-control form-control-middle" value="" name="shop[address]" id="address" placeholder="商户具体地址（必填、显示用）" data-valid="^.{3,}$" required="" autocomplete="off">
<div style="position:absolute;right:4px;top:9px;">
<button class="mui-btn " type="button" id="geo-btn" style="width: 78px;">定位地图</button>
</div>
</div>
<div class="form-text" id="lat-tip"></div>
<div class="form-text" id="lng-tip"></div>
<ul id="address-result" class="address-result"></ul>
<div style="background:#E0E0E0;text-align: center;font-size:0.78rem;margin-top:-1px;color:#999">
移动地图中心让红色的点定位在您想要的地址上即可
</div>
		<div id="map" style="width: 100%; height: 220px; overflow: hidden; position: relative; z-index: 0; color: rgb(0, 0, 0); text-align: left; background-color: rgb(243, 241, 236);">



		</div>
	</div>
 <!-- <h2 class="user-title">选填信息</h2>
<div class="mui-input-group mui-content-padded">
<div class="form-text" id="coupontip-tip" style="text-align:left">凭商家主页到店消费可获得：</div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear" name="shop_field[coupontip]" placeholder="只填礼品或优惠名称" id="coupontip" value="" data-input-clear="10"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
<div class="form-text" id="seotitle-tip" style="text-align:left">自定义分享到朋友圈标题：</div>
<div class="mui-input-row">
<input type="text" class="mui-input-clear" name="shop_field[seotitle]" placeholder="分享商家主页到朋友圈的标题" id="seotitle" value="" data-input-clear="11"><span class="mui-icon mui-icon-clear mui-hidden"></span>
</div>
</div> -->
<div class="mui-input-group mui-content-padded">
<div class="form-text" id="verify-tip"></div>
<div class="mui-input-row">
<select name="sid" id="sid">
<option value="0">请点击此处选择业务员</option>
<option value="0">无</option>
{loop $sellers $item}
<option value="{$item[id]}" {if $firm['sid']==$item['id']}selected{/if}>{$item[realname]}</option>
{/loop}
</select>
</div>
</div>

<input type="hidden" name="token" value="{$_W[token]}">
{if $w_login==1}
{if $w_bang==1}
<input type="button" class="mui-btn mui-btn-primary mui-btn-block" style="border: 1px solid #4cd964;
    background-color: #4cd964;color:#fff;height:60px;font-size:25px;" value="绑定微信号可在线支付" onclick="paybang()">
{else if $w_pay==1}
{if $firm[ismoney]==0&&$act[fee]>0&&$act[onlinepay]>0&&$firm[ischeck]==0}
<input type="button" class="mui-btn mui-btn-primary mui-btn-block" style="border: 1px solid #4cd964;
    background-color: rgba(70,189,98,0.9);color:#fff;height:60px;font-size:25px;"  id="pay" onclick="paylog()" value="自动开通【在线支付{$act[fee]}元】">
    {/if}
    {/if}
    {/if}
<div class="mui-content-padded"></div>

<input type="button"  style="font-size:25px;color:#fff;height:60px;border: 1px solid rgb(0, 129, 255);background-color: rgb(0, 129, 255);border-radius: 15px;margin-bottom: 20px;" class="mui-btn mui-btn-primary mui-btn-block" value="{if $firm[ischeck]==0}人工审核【其他支付】{else}保存修改{/if}" onclick="return check(this.form)">
	   <script type="text/javascript">
	function paybang(){
		window.location="{php echo $this->createMobileUrl('paybang',array('uid'=>$uid))}";
	}
	</script>
{if $firm[ischeck]==1&&$act[issmple]==1||$act[issmple]==0}
   <script type="text/javascript">

 function check(form) {
	 var title=$("#title").val();
		var province=$("#province").val();
		var city=$("#city").val();
		var district=$("#country").val();
		var address=$("#address").val();
		var location_x=$("#lng").val();
		var location_y=$("#lat").val();
		var intro=$("#intro").val();
		var tel=$("#tel").val();
		var sid=$("#sid").val();
		var parentid=$("#catid").val();
		var childid=$("#childid").val();
		var wei_num=$("#wei_num").val();
		var wei_sex=$("#wei_sex").val();
		var wei_name=$("#wei_name").val();
		var wei_intro=$("#wei_intro").val();
		var icon=$("#shopicon1").val();
		var img=$("#shopbanner1").val();
		var wei_avatar=$("#boss1").val();
		var wei_ewm=$("#bossqr1").val();
		var s_name=$("#s_name").val();
		var uid=$("#uid").val();
		var fid=$("#fid").val();
		var custom=$("#custom").val();
		var firmurl=$("#firmurl").val();
		var ischeck=$("#ischeck").val();
		var breaks=$("#breaks").val();
		var firmurl=$("#firmurl").val();
		var ismoney=$("#ismoney").val();
   	 if(wei_num=='') {
         alert("请输入老板微信号!");
         return false;
    }
     if(wei_intro=='') {
           alert("请输入老板描述!");
           return false;
      }
     if(wei_avatar=='') {
           alert("请添加老板头像!");
           return false;
      }
     if(wei_ewm=='') {
           alert("请添加老板二维码!");
           return false;
      }
     if(intro=='') {
         alert("请填写商户简介!");
         return false;
    }
     if(icon=='') {
           alert("请添加商户图标!");
           return false;
      }
     if(img=='') {
           alert("请添加商户横幅!");
           return false;
      }
		var obj="title="+title+"&province="+province+"&city="+city+"&district="+district
		+"&address="+address+"&location_x="+location_x+"&location_y="+location_y+"&intro="+intro+"&tel="+tel+"&sid="+sid
		+"&parentid="+parentid+"&childid="+childid+"&wei_num="+wei_num+"&wei_sex="+wei_sex
		+"&wei_name="+wei_name+"&wei_intro="+wei_intro+"&icon="+icon+"&img="+img+"&wei_avatar="+wei_avatar+
		"&wei_ewm="+wei_ewm+"&s_name="+s_name+"&uid="+uid+"&fid="+fid+"&custom="+custom+"&flag=submit&ischeck="+ischeck
		+"&breaks="+breaks+"&firmurl="+firmurl+"&ismoney="+ismoney;

 	var url="{php echo $this->createMobileurl('addb')}";
	$.post(url, obj, function (data) {
		 var data = eval('('+data+')');
        
      	 alert(data['res']);
     	 window.location.href=data['href'];
       

	});
     
     
    }
	function paylog(){
		var title=$("#title").val();
		var province=$("#province").val();
		var city=$("#city").val();
		var district=$("#country").val();
		var address=$("#address").val();
		var location_x=$("#lng").val();
		var location_y=$("#lat").val();
		var intro=$("#intro").val();
		var tel=$("#tel").val();
		var sid=$("#sid").val();
		var parentid=$("#catid").val();
		var childid=$("#childid").val();
		var wei_num=$("#wei_num").val();
		var wei_sex=$("#wei_sex").val();
		var wei_name=$("#wei_name").val();
		var wei_intro=$("#wei_intro").val();
		var icon=$("#shopicon1").val();
		var img=$("#shopbanner1").val();
		var wei_avatar=$("#boss1").val();
		var wei_ewm=$("#bossqr1").val();
		var s_name=$("#s_name").val();
		var uid=$("#uid").val();
		var fid=$("#fid").val();
		var custom=$("#custom").val();
		var firmurl=$("#firmurl").val();
		var obj="title="+title+"&province="+province+"&city="+city+"district&="+district
		+"&address="+address+"&location_x="+location_x+"&location_y="+location_y+"&intro="+intro+"&tel="+tel+"&sid="+sid
		+"&parentid="+parentid+"&childid="+childid+"&wei_num="+wei_num+"&wei_sex="+wei_sex
		+"&wei_name="+wei_name+"&wei_intro="+wei_intro+"&icon="+icon+"&img="+img+"&wei_avatar="+wei_avatar+
		"&wei_ewm="+wei_ewm+"&s_name="+s_name+"&uid="+uid+"&fid="+fid+"&fid="+fid+"&custom"+custom+"&firmurl"+firmurl;

   	 if(wei_num=='') {
         alert("请输入老板微信号!");
         return false;
    }
     if(wei_intro=='') {
           alert("请输入老板描述!");
           return false;
      }
     if(wei_avatar=='') {
           alert("请添加老板头像!");
           return false;
      }
     if(wei_ewm=='') {
           alert("请添加老板二维码!");
           return false;
      }
     if(intro=='') {
         alert("请填写商户简介!");
         return false;
    }
     if(icon=='') {
           alert("请添加商户图标!");
           return false;
      }
     if(img=='') {
           alert("请添加商户横幅!");
           return false;
      }
	 if(title=='') {
         alert("请输入商户名称!");
         return false;
    }
	 if(s_name=='') {
         alert("请输入申请人姓名!");
         return false;
    }
	 if(tel=='') {
         alert("请输入商铺电话!");
         return false;
    }
	 if(address=='') {
         alert("请输入商铺的详细地址!");
         return false;
    }
	var url="{php echo $this->createMobileurl('paylog')}";
	$.post(url, obj, function (data) {
		 var data = eval('('+data+')');
         if(data['error']){
      	 alert(data['error']);
           	return false;
           }else{
        	   $('#postform .params').val(data['params']);
             	 $('#postform').submit();
                          	return true;
           }

	});
	
 		
 	}     		 

 </script>
 {else}
 <script type="text/javascript">
 function check(form) {
	 var title=$("#title").val();
		var province=$("#province").val();
		var city=$("#city").val();
		var district=$("#country").val();
		var address=$("#address").val();
		var location_x=$("#lng").val();
		var location_y=$("#lat").val();
		var intro=$("#intro").val();
		var tel=$("#tel").val();
		var sid=$("#sid").val();
		var parentid=$("#catid").val();
		var childid=$("#childid").val();
		var wei_num=$("#wei_num").val();
		var wei_sex=$("#wei_sex").val();
		var wei_name=$("#wei_name").val();
		var wei_intro=$("#wei_intro").val();
		var icon=$("#shopicon1").val();
		var img=$("#shopbanner1").val();
		var wei_avatar=$("#boss1").val();
		var wei_ewm=$("#bossqr1").val();
		var s_name=$("#s_name").val();
		var uid=$("#uid").val();
		var ischeck=$("#ischeck").val();
		var fid=$("#fid").val();
	 if(title=='') {
         alert("请输入商户名称!");
         return false;
    }
	 if(s_name=='') {
         alert("请输入申请人姓名!");
         return false;
    }
	 if(tel=='') {
         alert("请输入商铺电话!");
         return false;
    }
	 if(address=='') {
         alert("请输入商铺的详细地址!");
         return false;
    }
	 var obj="title="+title+"&address="+address+"&location_x="+location_x+"&location_y="+location_y+"&parentid="+parentid+"&childid="+childid+"&tel="+tel+"&sid="+sid
		+"&s_name="+s_name+"&uid="+uid+"&flag=submit&ischeck="+ischeck+"&fid="+fid;
 	var url="{php echo $this->createMobileurl('addb')}";
	$.post(url, obj, function (data) {
		 var data = eval('('+data+')');
        
      	 alert(data['res']);
      	 window.location.href=data['href'];
       

	});
	 
	 
	 
	 
    }
 
	function paylog(){
		var title=$("#title").val();
		var province=$("#province").val();
		var city=$("#city").val();
		var district=$("#country").val();
		var address=$("#address").val();
		var location_x=$("#lng").val();
		var location_y=$("#lat").val();
		var intro=$("#intro").val();
		var tel=$("#tel").val();
		var sid=$("#sid").val();
		var parentid=$("#catid").val();
		var childid=$("#childid").val();
		var wei_num=$("#wei_num").val();
		var wei_sex=$("#wei_sex").val();
		var wei_name=$("#wei_name").val();
		var wei_intro=$("#wei_intro").val();
		var icon=$("#shopicon1").val();
		var img=$("#shopbanner1").val();
		var wei_avatar=$("#boss1").val();
		var wei_ewm=$("#bossqr1").val();
		var s_name=$("#s_name").val();
		var uid=$("#uid").val();
		var fid=$("#fid").val();
		
		var obj="title="+title+"&address="+address+"&location_x="+location_x+"&location_y="+location_y+"&parentid="+parentid+"&childid="+childid+"&tel="+tel+"&sid="+sid
		+"&s_name="+s_name+"&uid="+uid;
		 if(title=='') {
	         alert("请输入商户名称!");
	         return false;
	    }
		 if(s_name=='') {
	         alert("请输入申请人姓名!");
	         return false;
	    }
		 if(tel=='') {
	         alert("请输入商铺电话!");
	         return false;
	    }
		 if(address=='') {
	         alert("请输入商铺的详细地址!");
	         return false;
	    }
	var url="{php echo $this->createMobileurl('paylog')}";
	$.post(url, obj, function (data) {
		 var data = eval('('+data+')');
         if(data['error']){
      	 alert(data['error']);
           	return false;
           }else{
        	   $('#postform .params').val(data['params']);
             	 $('#postform').submit();
                          	return true;
           }

	});
	
 		
 	}     		 

 </script>
 
 {/if}

<div class="mui-content-padded">&nbsp;</div>
<div id="crop-dialog" class="mui-popover simple-dialog upload-dialog">
<div class="mui-popover-arrow"></div>
<div class="mui-content-padded">
<h4 style="text-align: center;margin: 10px;position: relative">
<div class="upload-progress"></div>
<div class="mui-pull-left">
<button type="button" class="mui-btn" id="crop-plus-btn">+</button>
<button type="button" class="mui-btn" id="crop-dec-btn">-</button>
<button type="button" class="mui-btn mui-icon mui-icon-refreshempty" style="font-size:0.9rem" id="crop-rotate-btn"></button>
</div>
<div class="mui-pull-right">
<button type="button" class="mui-btn mui-btn-blue" id="crop-submit-btn">确定</button>
<button type="button" class="mui-btn" id="crop-cancel-btn">取消</button>
</div>
<div class="mui-clearfix"></div>
</h4>
<div class="crop-img">
loading...
</div>
</div>
</div>
<div id="img-dialog" class="mui-popover simple-dialog" style="top:20px;left:20px;right:20px;">
<div class="mui-content-padded">
<div class="close" onclick="mui(&#39;#img-dialog&#39;).popover(&#39;hide&#39;)">×</div>
<div class="crop-img" style="">
<img src="" class="upload preview">
</div>
</div>
</div></form>

		    <form action="{php echo url('mc/cash/wechat');}" method="post" id="postform">                         
		<input type="hidden" name="params" class="params" value="{php echo base64_encode(json_encode($params));}" />
		<input type="hidden" name="encrypt_code" value="" />
		<input type="hidden" name="card_id" value="{php echo base64_encode($card_id);}" />
		<input type="hidden" name="coupon_id" value="" />
		</form>
<script src="../addons/enjoy_city/public/js/_v1_global.js"></script>
<script usetime="4.35ms">
function onBridgeReady() {WeixinJSBridge.call(hideWXMenu == 1 ? 'hideOptionMenu':'showOptionMenu');}
if (typeof WeixinJSBridge == "undefined") {
if (document.addEventListener) {
document.addEventListener('WeixinJSBridgeReady', onBridgeReady, false);
} else if (document.attachEvent) {
document.attachEvent('WeixinJSBridgeReady', onBridgeReady);
document.attachEvent('onWeixinJSBridgeReady', onBridgeReady);
}
} else {
try {
onBridgeReady();
}catch(e){}
}
</script><script src="../addons/enjoy_city/public/js/jweixin-1.1.0.js"></script>
<script type="text/javascript">
var imgurlcity="{php echo $this->createMobileUrl('imgload')}";
</script>
<script src="../addons/enjoy_city/public/js/_v1_shop_edit.js"></script>

<script>
initEvents.push(function () {
window.shopCallback = function (data) {
//todo succ or failure callback
mui.toast(data.data);
if (data && data.error == 0) {
window.onbeforeunload = null;
setTimeout(function () {
if ($('#pay').is(':checked')) {
location.href = '/pay/6tWykxRslIyNDQ0tjRR0lFKBnIKEit1izPyC4DclPzcxMw8oFhFhlItAPeSXmEsAAAA';
} else {
location.href = "/user/center.html";
}
}, 1000);
} else {
}
};

//级联示例
var catData = {$catdata};
	var catPicker = new mui.PopPicker({
layer: 2
});
catPicker.setData(catData);
$('#catPicker').on('click', function () {
catPicker.show(function (items) {
$('#catPicker').text((items[0] || {}).text + ' - ' + (items[1] || {}).text);
//$('#catid').val();
$('#catid').val((items[0] || {}).value);
$('#childid').val((items[1] || {}).value);
storeInput($('#catid,#childid'), true);
});
});
var cityPicker = new mui.PopPicker({
layer: 3
});
cityPicker.setData(cityData3);
var addressPicker = $('#addressPicker');
addressPicker.on('click', function (event) {
cityPicker.show(function (items) {
addressPicker.html((items[0] || {}).text + " " + (items[1] || {}).text + " " + (items[2] || {}).text);
$('#province').val((items[0] || {}).text);
$('#city').val((items[1] || {}).text);
$('#country').val((items[2] || {}).text);
storeInput($('#province,#city,#country'), true);
});
}, false);
var province = "{$firm['province']}";
if(province==''){province = "{$act['province']}"};
var city = "{$firm[city]}";
if(city==''){city = "{$act['city']}"};
var country = "{$firm[district]}";
if(country==''){country = "{$act['district']}"};
$('#province').val(province);
$('#city').val(city);
$('#country').val(country);
var store = window.store;
function storeInput(o, isStore) {
o.each(function () {
var saveField = $(this).attr('id');
if ($(this).attr('type') == 'radio') {
saveField = '';
if ($(this).is(':checked')) {
saveField = $(this).attr('name');
}
}
saveField && store.set('shop_edit_' + saveField, isStore ? $(this).val() : '');
});
}
function loadLocalStore() {
$('input,textarea').each(function () {
if ($(this).attr('type') == 'radio') {
var saveField = $(this).attr('name');
var saveValue = store.get('shop_edit_' + saveField);
if (saveValue == $(this).val()) {
$(this).attr('checked', true);
}
} else {
var saveField = $(this).attr('id');
if (saveField && ($(this).val() == '' || parseInt($(this).val()) == 0)) {
$(this).val(store.get('shop_edit_' + saveField));
}
}
});
}
var last_id = store.get('last_store_id');
if (!last_id || last_id == 111394) {
loadLocalStore();
} else {
$('input,textarea').each(function () {
storeInput($(this));
});
}
store.set('last_store_id', 111394);
$('input,textarea').on('blur click', function () {
storeInput($(this), true);
});
// set cat picker
var cat_id = "0";
var child_id = "0";
if (cat_id < 1) {
cat_id = store.get('shop_edit_catid');
}
if (child_id < 1) {
child_id = store.get('shop_edit_childid');
}
var catText = '';
for (var i in catData) {
if (catData[i].id == cat_id) {
catPicker.pickers[0].setSelectedIndex(i);
catText = catData[i].text;

var children = catData[i].children;

if (children && children.length > 0 && child_id) {
for (var j in children) {
if (children[j].id == child_id) {
catPicker.pickers[1].setSelectedIndex(j);
catText += ' - ' + children[j].text;
}
}

}
}
}
if (catText) {
$('#catPicker').html(catText);
}
// set city picker
for (var i in cityData3) {
if (cityData3[i].text == $('#province').val()) {
cityPicker.pickers[0].setSelectedIndex(i);
}
var children = cityData3[i].children;
if (children && $('#city').val()) {
for (var j in children) {
if (children[j].text == $('#city').val()) {
cityPicker.pickers[1].setSelectedIndex(j);
// find second pickers
var childChildren = children[j].children;
if (childChildren && $('#country').val()) {
for (var k in childChildren) {
if (childChildren[k].text == $('#country').val()) {
cityPicker.pickers[2].setSelectedIndex(k);
}
}
}
}
}
}
}
var addressText = '';
if ($('#province').val() != '') {
addressText += $('#province').val();
}
if ($('#city').val() != '') {
addressText += ' - ' + $('#city').val();
}
if ($('#country').val() != '') {
addressText += ' - ' + $('#country').val();
}
if (addressText) {
$('#addressPicker').html(addressText);
}
var map = new BMap.Map("map");
// 创建地址解析器实例
var geo = new BMap.Geocoder();
var x=$("#lng").val();
var y=$("#lat").val();

var marker = new BMap.Marker(new BMap.Point(x, y));
map.addOverlay(marker);
map.enableScrollWheelZoom();
map.enableKeyboard();
function saveMapPoint(point) {
$("#lat").val(point.lat);
$("#lng").val(point.lng);
storeInput($('#lat'), 1);
storeInput($('#lng'), 1);
}
function setMapPoint(point) {
map.centerAndZoom(point, 19);
marker.setPosition(point);
saveMapPoint(point);
}
function getGeoLocation(address) {
address = typeof address == 'string' ? address : $('#address').val();
geo.getPoint(address, function (point) {
if (point) {
setMapPoint(point);
}
}, $('#country').val());
// clear address result
$("#address-result").html('');
}
// get geolocation btn
$('#geo-btn').on('click', getGeoLocation);
// set default location

if (parseFloat($("#lat").val()) != 0) {
setMapPoint(new BMap.Point(parseFloat($('#lng').val()), parseFloat($('#lat').val())));
} else {
map.centerAndZoom(addressText, 19);
}
// zoom bgtn
var topRightNav = new BMap.NavigationControl({
anchor: BMAP_ANCHOR_TOP_RIGHT,
type: BMAP_NAVIGATION_CONTROL_SMALL
});
map.addControl(topRightNav);
// set location btn
var geolocationControl = new BMap.GeolocationControl();
geolocationControl.addEventListener("locationSuccess", function (e) {
var address = '';
address += e.addressComponent.province;
address += e.addressComponent.city;
address += e.addressComponent.district;
address += e.addressComponent.street;
address += e.addressComponent.streetNumber;
if (confirm('检测到您的地址为,是否填入地址栏中：\r\n' + address)) {
$('#address').val(address);
}
});
map.addControl(geolocationControl);
map.addEventListener("click", function (e) {
setMapPoint(e.point);
});
map.addEventListener('moving', function (e) {
var point = map.getCenter();
marker.setPosition(point);
saveMapPoint(point);
});
var options = {
onSearchComplete: function (results) {
// 判断状态是否正确
if (local.getStatus() == BMAP_STATUS_SUCCESS) {
var s = [];
$("#address-result").html('<li>点击以下地址可快速定位：</li>');
for (var i = 0; i < results.getCurrentNumPois(); i++) {
var poi = results.getPoi(i);
$("#address-result").append('<li data-point="' + poi.point.lng + ',' + poi.point.lat + '">' + poi.title + "," + poi.address + '</li>');
}
}
}
};
var local = new BMap.LocalSearch(map, options);
$('#address').on('keyup', function () {
local.search($('#province').val() + $('#country').val() + $('#address').val());
});
$(document).on(window.CLICK_EVENT, '#address-result li[data-point]', function () {
var address = $(this).text();
var point = $(this).data('point').split(/,/ig);
$('#address').val(address).blur();
setMapPoint(new BMap.Point(parseFloat(point[0]), parseFloat(point[1])));
$("#address-result").html('');
});
});
</script>
<div class="mui-poppicker">
	<div class="mui-poppicker-header">
		<button class="mui-btn mui-poppicker-btn-cancel">取消</button>
		<button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button>
		<div class="mui-poppicker-clear"></div>
	</div>

</div>
<div class="mui-poppicker">
	<div class="mui-poppicker-header">
		<button class="mui-btn mui-poppicker-btn-cancel">取消</button>
		<button class="mui-btn mui-btn-blue mui-poppicker-btn-ok">确定</button>
		<div class="mui-poppicker-clear"></div>
	</div>
	<div class="mui-poppicker-body">
		<div class="mui-picker" style="width: 33.3333%;">
			<div class="mui-picker-inner">
				<div class="mui-pciker-rule mui-pciker-rule-ft"></div>
				<ul class="mui-pciker-list"
					style="transform: perspective(1000px) rotateY(0deg) rotateX(340deg);">
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(0deg);">北京市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-20deg);">天津市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-40deg);">河北省</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-60deg);">山西省</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-80deg);">内蒙古</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-100deg);">辽宁省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-120deg);">吉林省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-140deg);">黑龙江省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-160deg);">上海市</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-180deg);">江苏省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-200deg);">浙江省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-220deg);">安徽省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-240deg);">福建省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-260deg);">江西省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-280deg);">山东省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-300deg);">河南省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-320deg);">湖北省</li>
					<li class="highlight"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-340deg);">湖南省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-360deg);">广东省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-380deg);">广西壮族</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-400deg);">海南省</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-420deg);">重庆</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-440deg);">四川省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-460deg);">贵州省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-480deg);">云南省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-500deg);">西藏</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-520deg);">陕西省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-540deg);">甘肃省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-560deg);">青海省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-580deg);">宁夏</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-600deg);">新疆</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-620deg);">台湾省</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-640deg);">香港</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-660deg);">澳门</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-680deg);">海外</li>
				</ul>
				<div class="mui-pciker-rule mui-pciker-rule-bg"></div>
			</div>
		</div>
		<div class="mui-picker" style="width: 33.3333%;">
			<div class="mui-picker-inner">
				<div class="mui-pciker-rule mui-pciker-rule-ft"></div>
				<ul class="mui-pciker-list"
					style="transform: perspective(1000px) rotateY(0deg) rotateX(240deg);">
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(0deg);">长沙市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-20deg);">株洲市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-40deg);">湘潭市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-60deg);">衡阳市</li>
					<li class=""
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-80deg);">邵阳市</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-100deg);">岳阳市</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-120deg);">常德市</li>
					<li
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-140deg);">张家界市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-160deg);">益阳市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-180deg);">郴州市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-200deg);">永州市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-220deg);">怀化市</li>
					<li class="highlight"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-240deg);">娄底市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-260deg);">湘西土家族苗族自治州</li>
				</ul>
				<div class="mui-pciker-rule mui-pciker-rule-bg"></div>
			</div>
		</div>
		<div class="mui-picker" style="width: 33.3333%;">
			<div class="mui-picker-inner">
				<div class="mui-pciker-rule mui-pciker-rule-ft"></div>
				<ul class="mui-pciker-list"
					style="transform: perspective(1000px) rotateY(0deg) rotateX(40deg);">
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(0deg);">娄星区</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-20deg);">双峰县</li>
					<li class="visible highlight"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-40deg);">新化县</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-60deg);">冷水江市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-80deg);">涟源市</li>
					<li class="visible"
						style="transform-origin: center center -89.5px; transform: translateZ(89.5px) rotateX(-100deg);">其它区</li>
				</ul>
				<div class="mui-pciker-rule mui-pciker-rule-bg"></div>
			</div>
		</div>
	</div>
</div>
</body>
</html>
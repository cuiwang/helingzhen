<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>{$reply['title']}--{$_W['account']['name']}</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
<meta name="Description" content="{$reply['description']}" />
<!-- Mobile Devices Support @begin -->
<meta content="application/xhtml+xml;charset=UTF-8" http-equiv="Content-Type">
<meta content="no-cache,must-revalidate" http-equiv="Cache-Control">
<meta content="no-cache" http-equiv="pragma">
<meta content="0" http-equiv="expires">
<meta content="telephone=no, address=no" name="format-detection">
<meta name="apple-mobile-web-app-capable" content="yes" /> <!-- apple devices fullscreen -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<!-- Mobile Devices Support @end -->
<link href="{MODULE_URL}template/css/style.css?{php echo time()}" rel="stylesheet" type="text/css" />
<script src="{$_W['siteroot']}app/resource/js/lib/jquery-1.11.1.min.js?{php echo time()}"></script>
</head>
<style>
html{font-size:{$template['fontsize']}px; color:{$template['textcolor']};}
html{background-image: url('{php echo toimage($template['bgimg'])}');}
html{background-color: {$template['bgcolor']};}
body{font-size:{$template['fontsize']}px;color:{$template['textcolor']};}
a:link, a:visited, a:hover, a:active { color:{$template['textcolorlink']}; text-decoration:none; } 
.mingdan{background-color:{$template['buttoncolor']};border:1px {$template['buttoncolor']} solid ;}
.biaoti{color:{$template['buttontextcolor']};}
.biaoti a{ color:{$template['buttontextcolor']};}
.mingdaninfo{background-color:{$template['rulecolor']};	border:1px {$template['rulecolor']} solid ;color:{$template['ruletextcolor']};}
/* 弹出层CSS */
.panel-box .panel-content{color: {$template['watchtextcolor']};	background-color: {$template['watchcolor']};}
.panel-box .btn-confirm,.panel-box .btn-confirm2{background: {$template['buttoncolor']};color: {$template['buttontextcolor']};}
.panelbox .btn-confirm,.panelbox .btn-confirm2{background: {$template['buttoncolor']};color: {$template['buttontextcolor']};}
/* 弹出层CSS */
/* 兑奖按钮CSS */
.btnduihuan {background: {$template['awardcolor']};color: {$template['awardtextcolor']};}
.btn_duihuan {background: {$template['awardscolor']};color: {$template['awardstextcolor']};}
/* 兑奖按钮CSS */
.headimgurl{height:100px;}
.headimgurl img{width:80px;height:80px;margin:0 auto;}
.panelbox .panel-contents{
	text-align: center;
	font-size: 16px;
	color: {$template['watchtextcolor']};
	margin: auto 20px;
	padding: 10px;
}
</style>
<body>
<div><img src="{php echo toimage($reply['toppic'])}" width="100%"></div>
<div class="panelbox">
	<div class="panel-contents">
	<div style="line-height:150%;font-size:24px;color:{$template['navactioncolor']};"><b>恭喜您！</b></div>
	<div style="line-height:150%;font-size:18px;color:{$template['navactioncolor']};">{$reply['lingquanniutips']}</div>
	{if $fansreg}
	<div style="line-height:150%;">{$exchange['awarding_tips']}</div>
	<div>
	{if $exchange['isrealname']}<div style="width:100%;"><input name="realname" class="px" id="realname" value="{$profile['realname']}" type="text" placeholder="请输入{$isfansname[0]}"></div>{/if}
	{if $exchange['ismobile']}
	<div style="width:100%;"><input name="mobile" class="px" id="mobile" value="{$profile['mobile']}" type="tel" placeholder="请输入{$isfansname[1]}"></div>
	{if $reply['redpacktype']}
	<div style="width:100%;">
	    <select name="mobile_company" id="mobile_company" class="px">
			<option value=""{if $mobile_company == ''} selected{/if}>请选择运营商</option>
			<option value="中国移动"{if $mobile_company == '中国移动'} selected{/if}>中国移动</option>
			<option value="中国联通"{if $mobile_company == '中国联通'} selected{/if}>中国联通</option>
			<option value="中国电信"{if $mobile_company == '中国电信'} selected{/if}>中国电信</option>
	    </select>
	</div>
	{/if}
	{/if}
	{if $exchange['isqq']}<div style="width:100%;"><input name="qq" class="px" id="qq" value="{$profile['qq']}" type="tel" placeholder="请输入{$isfansname[2]}"></div>{/if}
	{if $exchange['isemail']}<div style="width:100%;"><input name="email" class="px" id="email" value="{$profile['email']}" type="text" placeholder="请输入{$isfansname[3]}"></div>{/if}
	{if $exchange['isaddress']}<div style="width:100%;"><input name="address" class="px" id="address" value="{$profile['address']}" type="text" placeholder="请输入{$isfansname[4]}"></div>{/if}
	{if $exchange['istelephone']}<div style="width:100%;"><input name="telephone" class="px" id="telephone" value="{$profile['telephone']}" type="tel" placeholder="请输入{$isfansname[6]}"></div>{/if}
	{if $exchange['isidcard']}<div style="width:100%;"><input name="idcard" class="px" id="idcard" value="{$profile['idcard']}" type="text" placeholder="请输入{$isfansname[7]}"></div>{/if}
	{if $exchange['iscompany']}<div style="width:100%;"><input name="company" class="px" id="company" value="{$profile['company']}" type="text" placeholder="请输入{$isfansname[8]}"></div>{/if}
	{if $exchange['isoccupation']}<div style="width:100%;"><input name="occupation" class="px" id="occupation" value="{$profile['occupation']}" type="text" placeholder="请输入{$isfansname[9]}"></div>{/if}
	{if $exchange['isposition']}<div style="width:100%;"><input name="position" class="px" id="position" value="{$profile['position']}" type="text" placeholder="请输入{$isfansname[10]}"></div>{/if}
	{if $reply['smsverify']}<div style="width:100%;"><input name="smsverify" class="px" id="smsverify" style="width:59%;float:left;margin-top:0px;" type="tel" placeholder="请输入短信验证码"><button class="btn-confirm" id="btnsender" style="border-radius: 0.6em;width:40%;float:right;height:37px;font-size:12px;">获取验证码</button></div>{/if}
	</div>
	<div id="result_info_tip" style="width:100%;clear:both"></div>
	<div class="btn-layout">
		<button class="btn-confirm" id="save-btn">{$reply['lingquanniu']}</button>
    </div>
	<div style="font-size:12px;padding:10px;">{$exchange['warning_tips']}</div>
	{else}
	<div id="result_info_tip" style="width:100%;clear:both"></div>
	{/if}
</div>
<!--分享按钮-->
<div id="pop_share"><img src="{php echo toimage($share['share_pic'])}" width="100%" alt="分享到朋友圈"/></div>
<!--分享按钮-->
<div style="text-align:center;margin:10px;clear:both;color:{$template['textcolor']};"><a href="{php echo $this->createMobileUrl('rule', array('rid' => $rid))}">活动规则</a>  <a href="tel:{$reply['helptel']}">咨询电话：{$reply['helptel']}</a> ©{$reply['copyright']}</div>
<script type="text/javascript">
{if $exchange['ismobile'] && $reply['redpacktype']}
<!--手机运营商判断-->
$('#mobile').bind('input propertychange', function(){
    var mobile = $("#mobile").val();
	var partten = /^1\d{10}$/;
	if(partten.test(mobile)){
	    var params = {};
	    params.mobile = mobile;
		$.post('{php echo $this->createMobileUrl('mverify')}', params, function(data) {
		    if (data.success == 1) {
				$("#mobile_company").val(data.msg);
				return;
	        }else{
		        $("#result_info_tip").text(data.msg);
				setTimeout(function () { 
			        $("#result_info_tip").text();
			    }, 3000);
		        return;
	        }
	    },"json")
	}
});
<!--手机运营商判断-->
{/if}
{if $reply['smsverify']}
<!--短信验证-->
var btnsenderclick=false;
$("#btnsender").bind("click",function () {
	if (btnsenderclick) {
		return;
	}else{
		btnsenderclick = true;
		$("#btnsender").attr("disabled", true);
		var mobile = $("#mobile").val();
		sendCode(mobile, function(ret, message){
			if(ret == 'failed') {
				$("#result_info_tip").text('获取验证码失败. 详情: ' + message);
				setTimeout(function () { 
			        $("#result_info_tip").text('');
			    }, 3000);
			}
		});
	    return;
	}
});

function sendCode(mobile, callback) {
	if(!mobile) {
		if($.isFunction(callback)) {
			callback('failed', '给定的参数有错误');
		}
		return;
	}
	var downcount = 60;
	$("#btnsender").html(downcount + "秒后重新获取");
	var timer = setInterval(function(){
	    downcount--;
	    if(downcount <= 0){
		    clearInterval(timer);
		    $("#btnsender").html("重新获取验证码");
			$("#btnsender").removeAttr("disabled");
			btnsenderclick=false;
		    downcount = 60;
	    }else{
		    if($.isFunction(callback)) {
			    callback('downcount', downcount);
		    }
		    $("#btnsender").html(downcount + "秒后重新获取");
	    }
    }, 1000);
	var params = {};
	params.mobile = mobile;
	params.rid = {$rid};
	$.post('{php echo $this->createMobileUrl('verifycode')}', params).success(function(dat){
		if(dat == 'success') {
			if($.isFunction(callback)) {
				callback('success', null);
			}
		}else{
			if($.isFunction(callback)) {
				callback('failed', dat);
			}
		}
	});
};
<!--短信验证-->
{/if}
<!--保存数据-->
$("#save-btn").bind("click",function () {
	$("#save-btn").attr("disabled", true);
	$("#save-btn").css("background","#CCC").siblings("button").css("background","#000");
	var btn = $(this);
    {if $exchange['isrealname']}
	var realname = $("#realname").val();
	if (realname == '') {
	    $("#result_info_tip").text("请输入{$isfansname[0]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	var partten = /[\u4e00-\u9fa5]/g;
	if(!partten.test(realname)){
	    $("#result_info_tip").text("请输入正确的{$isfansname[0]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['ismobile']}
	var mobile = $("#mobile").val();
	if (mobile == '') {
	    $("#result_info_tip").text("请输入{$isfansname[1]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	var partten = /^1\d{10}$/;
	if(!partten.test(mobile)){
	    $("#result_info_tip").text("请输入正确的{$isfansname[1]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{if $reply['redpacktype']}
	var mobile_company = $("#mobile_company").val();
	if (mobile_company == '') {
	    $("#result_info_tip").text("请选择运营商");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{/if}
	{if $reply['smsverify']}
	var smsverify = $("#smsverify").val();
	if (smsverify == '') {
	    $("#result_info_tip").text("请输入短信验证码");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isqq']}
	var qq = $("#qq").val();
	if (qq == '') {
	    $("#result_info_tip").text("请输入{$isfansname[2]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}			
	var partten = /^[1-9]{1}\d{4,11}$/;
	if(!partten.test(qq)){
	    $("#result_info_tip").text("请输入正确的{$isfansname[2]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isemail']}
	var email = $("#email").val();
	if (email == '') {
	    $("#result_info_tip").text("请输入{$isfansname[3]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	var partten = /^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
	if(!partten.test(email)){
	    $("#result_info_tip").text("请输入正确的{$isfansname[3]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isaddress']}
	var address = $("#address").val();
	if (address == '') {
	    $("#result_info_tip").text("请输入{$isfansname[4]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['istelephone']}
	var telephone = $("#telephone").val();
	if (telephone == '') {
	    $("#result_info_tip").text("请输入{$isfansname[6]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isidcard']}
	var idcard = $("#idcard").val();
	if (idcard == '') {
	    $("#result_info_tip").text("请输入{$isfansname[7]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['iscompany']}
	var company = $("#company").val();
	if (company == '') {
	    $("#result_info_tip").text("请输入{$isfansname[8]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isoccupation']}
	var occupation = $("#occupation").val();
	if (occupation == '') {
	    $("#result_info_tip").text("请输入{$isfansname[9]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	{if $exchange['isposition']}
	var position = $("#position").val();
	if (position == '') {
	    $("#result_info_tip").text("请输入{$isfansname[10]}");
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
	    return;
	}
	{/if}
	var avatar = '{$userinfo['headimgurl']}';
	var nickname = '{$userinfo['nickname']}';
	var province = '{$userinfo['province']}';
	var city = '{$userinfo['city']}';
	var sex = '{$userinfo['sex']}';
	var inpoint = '{$inpoint}';
	var submitData = {
        {if $exchange['isrealname']}realname: realname,{/if}
		{if $exchange['ismobile']}
		mobile: mobile,
		{if $reply['redpacktype']}mobile_company: mobile_company,{/if}
		{/if}
		{if $reply['smsverify']}smsverify: smsverify,{/if}
		{if $exchange['isqq']}qq: qq,{/if}
		{if $exchange['isemail']}email: email,{/if}
		{if $exchange['isaddress']}address: address,{/if}
		{if $exchange['istelephone']}telephone: telephone,{/if}
		{if $exchange['isidcard']}idcard: idcard,{/if}
		{if $exchange['iscompany']}company: company,{/if}
		{if $exchange['isoccupation']}occupation: occupation,{/if}
		{if $exchange['isposition']}position: position,{/if}
		avatar: avatar,
		nickname: nickname,
		province: province,
		city: city,
		sex: sex,
		inpoint: inpoint,
	};
	$.post('{php echo $this->createMobileUrl('regfans', array('rid' => $rid))}', submitData, function(data) {
	if (data.success == 1) {
		$("#pop_share").show();
		return;
	}else{
		$("#result_info_tip").text(data.msg);
		setTimeout(function () { 
			$("#result_info_tip").text('');
			$("#save-btn").removeAttr("disabled");
	        $("#save-btn").css("background","{$template['buttoncolor']}").siblings("button").css("background","{$template['buttoncolor']}");
		}, 3000);
		return;
	}
	},"json")
});	
{if $fansreg == false}
	var avatar = '{$userinfo['headimgurl']}';
	var nickname = '{$userinfo['nickname']}';
	var province = '{$userinfo['province']}';
	var city = '{$userinfo['city']}';
	var sex = '{$userinfo['sex']}';
	var inpoint = '{$inpoint}';
	var submitData = {
		avatar: avatar,
		nickname: nickname,
		province: province,
		city: city,
		sex: sex,
		inpoint: inpoint,
	};
	$.post('{php echo $this->createMobileUrl('regfans', array('rid' => $rid))}', submitData, function(data) {
	if (data.success == 1) {
		$("#pop_share").show();
		return;
	}else{
		$("#result_info_tip").text(data.msg);
		setTimeout(function () { 
			$("#result_info_tip").text('');
		}, 3000);
		return;
	}
	},"json")
{/if}
<!--保存数据-->
$("#pop_share").click(function(){
    window.location.href='{php echo $this->createMobileUrl('index', array('rid' => $rid))}';
	$("#pop_share").hide();
	$(".panelbox").hide();
});
</script>
{template 'jssdk'}
</body>
</html>
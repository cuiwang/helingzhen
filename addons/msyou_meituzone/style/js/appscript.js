var $lists=document.querySelector("#lists"),msnry=new Masonry($lists,{columnWidth:".grid-sizer",itemSelector:".item"});
$(function(){window.optionchanged=!1;$("#userTab a").click(function(a){a.preventDefault();$(this).tab("show")});state1=function(){$(".yao").removeClass("yao2");$(".yao").addClass("yao1");setTimeout(state2,200)};state2=function(){$(".yao").removeClass("yao1");$(".yao").addClass("yao2");setTimeout(state3,200)};state3=function(){$(".yao").removeClass("yao2");setTimeout(state1,200)};state1();0<=reply_musicurl.length&&playbox.init("playbox");setTimeout(function(){$("#coverurl").animate({opacity:"0"},1E3,
"swing",function(){$(this).hide()})},5E3);list("")});function reloadlists(a,b){for(var c=[],f=$lists.childNodes.length-1;1<=f;f--)c.push($lists.childNodes[f]);msnry.remove(c);msnry.layout();orderstr=0==a?orderstr0:orderstr1;$("#lists").attr("scrolltop",0);pageIndex=1;isload=!0;list(b);isload=b?!1:!0}
function mytoggle(a,b){hidetop=$(document).scrollTop();showtop=void 0===a.attr("scrolltop")?0:a.attr("scrolltop");b.animate({opacity:"0"},100,"swing",function(){b.hide();b.attr("scrolltop",hidetop);a.show();$("body,html").scrollTop(showtop);a.animate({opacity:"1"},100,"swing",function(){})})}
function displayit(a){for(i=0;100>i;i++)if(i==a){var b="menu_list"+a;"none"==document.getElementById(b).style.display?document.getElementById(b).style.display="":document.getElementById(b).style.display="none"}else $("#menu_list"+i)&&$("#menu_list"+i).css("display","none")}function closeall(){var a=document.getElementById("top_menu").getElementsByTagName("ul").length;for(i=0;i<a;i++)document.getElementById("top_menu").getElementsByTagName("ul").item(i).style.display="none"}
function usersubmit(){$.ajax({url:index_url+"&usersubmit=1",data:{nickname:$("#nickname").val(),mobile:$("#mobile").val()},type:"post",dataType:"json",success:function(a){try{a.error?showMsg({msg:a.error}):(showMsg({msg:"\u4e2a\u4eba\u4fe1\u606f\u66f4\u65b0\u6210\u529f\uff01"}),closeall())}catch(b){showMsg({msg:"\u52a0\u8f7d\u5f02\u5e38\uff01"+b.message})}},error:function(a,b,c){showMsg({msg:"<label>"+JSON.stringify(a)+"</label><label>"+JSON.stringify(c)+"</label>"})}})}
var pageIndex=1,pageSize=reply_pagesize,orderstr=" createtime desc ",orderstr0=" createtime desc ",orderstr1=" sumcount desc ",isload=!0,reload=!0;GPC_pageid&&showpage(GPC_pageid);
function list(a){0!=isload&&0!=reload&&(reload=!1,$.ajax({url:index_url+"&showmore=1",data:{pageIndex:pageIndex,pageSize:pageSize,orderstr:orderstr,searchstr:a},type:"post",dataType:"json",success:function(b){try{if(b.error)showMsg({msg:b.error});else if(0==b.list.length||b.total<=(pageIndex+1)*pageSize&&(a=""))isload=!1,showMsg({msg:"\u5df2\u7ecf\u5168\u90e8\u52a0\u8f7d\uff01"});else{replycount(b.replycount);pageIndex+=1;var c=[],f=document.createDocumentFragment();$.each(b.list,function(a,b){var d=
getHtml(b);$(d).hide();f.appendChild(d);c.push(d)});var d=document.createElement("div");d.className="item";d.style.cssText="min-width:200px;min-height:200px;";d.innerHTML='<div class="tc-gridbox" style="min-width:200px;min-height:200px;text-align: center;"><iframe frameborder="no" scrolling="no" style="height: 200px;width: 200px;overflow:hidden;" src="http://www.msyou.cc/baiduhtml.html"></iframe></div>';$(d).hide();f.appendChild(d);c.push(d);$lists.appendChild(f);$("#lists").imagesLoaded(function(){msnry.appended(c);
msnry.layout()})}}catch(g){showMsg({msg:"\u52a0\u8f7d\u5f02\u5e38\uff01"+g.message})}reload=!0},error:function(a,c,f){showMsg({msg:"<label>"+JSON.stringify(a)+"</label><label>"+JSON.stringify(f)+"</label>"})}}))}
function getHtml(a){content=JSON.parse(a.content);var b=document.createElement("div");b.className="item";b.innerHTML='<div class="tc-gridbox">\t                        <div class="header">'+(1==reply_indexshownick?'<div style="padding: 5px;">\t                        <div class="pull-left">\t\t\t<img src='+a.avatar+" onerror=\"this.src='"+def_userimg+'\'" class="img-responsive" style="width: 30px;height: 30px;float: left;border-radius: 45px;">\t\t\t<span style="padding:5px;line-height:30px;">'+(null===
a.nickname?"\u65e0\u540d":a.nickname)+'</span>\t                        </div>\t                        <div class="pull-right" id="minebh" style="padding-left:5px;">\t                        \t<small>\u7f16\u53f7</small>\t\t                        <label style="font-size:18px;">'+a.bh+'</label>\t                        </div>\t                        <div class="pull-right" id="minepm" style="padding-left:5px;">\t                        \t<small>\u6392\u540d</small>\t\t                        <label style="font-size:18px;">'+
a.pm+'</label>\t                        </div>\t                        <div class="clearfix">\t                        </div>                        </div>':"")+'\t\t\t\t\t\t\t\t<div class="item-image" onclick="showpage('+a.id+')">\t\t\t\t\t\t\t\t\t<img  src="'+a.imgurl+'" onerror="this.src=\''+reply_topurl+'\'" class="img-responsive" style="width:100%;">\t\t\t\t\t\t\t\t</div>\t                        </div>'+(1==reply_indexshowcontent?'\t                        <div class="body">\t                        \t'+
content.content+"\t                        </div>":"")+'\t                            <hr style="margin:0;">\t                        <div class="footer">\t                        \t<div class="pull-left">\t\t\t\t\t\t\t\t\t<i class="fa fa-share-alt" style="padding-left: 5px;"></i><span class="count share'+a.id+'">'+a.sharecount+'</span>\t\t                        \t<i class="fa fa-eye" style="padding-left: 5px;"></i><span class="count view'+a.id+'">'+a.viewcount+'</span>\t\t\t\t\t\t\t\t</div>\t                        \t<div class="pull-right" style="height:30px;">\x3c!--<span class="meta">'+
a.createtime+"</span>--\x3e"+(1==reply_indexshowzan?'           <i class="fa fa-thumbs-up" style="font-size:18px;background-color: #ddd;padding: 5px;border-radius: 5px;" onclick="dianzan('+a.id+","+a.bh+');"><span class="count zan'+a.id+'">'+a.zancount+"</span>&nbsp\u70b9\u8d5e</i>":'\t\t\t\t\t\t\t\t\t<i class="fa fa-thumbs-up"></i><span class="count zan'+a.id+'">'+a.zancount+"</span>")+'\t\t\t\t\t\t\t\t\t\x3c!-- <i class="fa fa-thumbs-up"></i><span class="count zan'+a.id+'">'+a.zancount+'</span> --\x3e\t\t\t\t\t\t\t\t</div>\t                        \t<div class="clearfix">\t\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>';
return b}
function replycount(a){null!=a&&$("#replycount").html('\t\t\t\t\t\t<td style="width:24%;border-right: 1px solid #ddd;text-align:center;">'+(void 0===a.joincount?0:a.joincount)+'\t\t\t\t\t\t</td>\t\t\t\t\t\t<td style="width:24%;border-right: 1px solid #ddd;text-align:center;">'+(void 0===a.zancount?0:a.zancount)+'\t\t\t\t\t\t</td>\t\t\t\t\t\t<td style="width:24%;border-right: 1px solid #ddd;text-align:center;">'+(void 0===a.sharecount?0:a.sharecount)+'\t\t\t\t\t\t</td>\t\t\t\t\t\t<td style="width:24%;text-align:center;">'+(void 0===
a.viewcount?0:a.viewcount)+"\t\t\t\t\t\t</td>")}function listcount(a,b){null!=b&&($(".zan"+a).html(b.zancount),$(".share"+a).html(b.sharecount),$(".view"+a).html(b.viewcount))}
function showpage(a){wx.hideOptionMenu();$.ajax({url:index_url,data:{lid:a,showpage:1},type:"post",dataType:"json",success:function(b){if(b.error)showMsg({msg:b.error});else{replycount(b.replycount);upd_sharedata(b.p_share);e=b.list;listcount(a,e);content=JSON.parse(e.content);$("#page").find("#page-header-bh").html(e.bh);$("#page").find("#page-header-pm").html(e.pm);$("#page").find("#page-header-df").html(e.sumcount);$("#page").find("#page-header-nickname").html(null===e.nickname?"\u65e0\u540d":
e.nickname);$("#page").find("#page-header-avatar").attr("src",null===e.avatar?def_userimg:e.avatar);$("#page").find("#page-body-content").html(content.content);var c="";$.each(content.imglists,function(a,b){b&&(c+='<div class="image" style="padding:5px;text-align: center;"><img  data-src="'+b+'" src="'+b+'" onerror="this.src=\''+reply_topurl+'\'" class="img-responsive" style="margin: 0 auto;"></div>')});$("#page").find("#page-body-images").html(c);$("#page").find("#page-footer-zhan").html(e.zancount);
$("#page").find("#page-footer-zhan").attr("class","count zan"+e.id);$("#page").find("#page-footer-zhan").attr("zan-id",e.id);$("#page").find("#page-footer-zhan").attr("zan-bh",e.bh);$("#page").find("#page-footer-share").html(e.sharecount);$("#page").find("#page-footer-view").html(e.viewcount);$("#page").find("#page-footer-date").html(e.createtime);$("#myModal_page").modal("show")}},error:function(a,c,f){showMsg({msg:"<label>"+JSON.stringify(a)+"</label><label>"+JSON.stringify(f)+"</label>"})}})}
function dianzan(a,b){0==isgzzan?show_guanzhu(":"+b):$.ajax({url:index_url,data:{lid:a,dianzan:1},type:"post",dataType:"json",success:function(a){try{a.error?showMsg({msg:a.error}):(replycount(a.replycount),listcount(a.listid,a.listcount),showMsg({msg:"\u70b9\u8d5e \u6210\u529f\uff01"}))}catch(b){showMsg({msg:"\u52a0\u8f7d\u5f02\u5e38\uff01"+b.message})}},error:function(a,b,d){showMsg({msg:"<label>"+JSON.stringify(a)+"</label><label>"+JSON.stringify(d)+"</label>"})}})}
$(function(){$(window).scroll(function(){parseFloat($(window).height())+parseFloat($(window).scrollTop())>=$(document.body).height()&&setTimeout(list(""),200)})});
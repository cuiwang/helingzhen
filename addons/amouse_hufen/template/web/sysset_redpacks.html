{template 'common/header'}
<div class="clearfix">
    {template 'web/tab_header'}
    <form id="theform" class="form form-horizontal" action="" enctype="multipart/form-data" method="post">
        <input type='hidden' name='op' value="redpacks"/>
        <input type='hidden' name='redid' value="{$settings['id']}"/>
        <div class="panel panel-default">
            <div class="panel-heading">
                注意事项
            </div>
            <div class="panel-body">
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
                    <div class="col-sm-9 col-xs-12">
                        <div class="alert alert-info">
                            发放红包需要使用
                            <span class="label label-info">认证服务号并开通微信支付</span> <br>
                            发放红包全部配置好后可以在名片管理那边测试给自己发送。如果配置不正确会报错.
                            <br>
                            <kbd>推广红包任务需要配置此处信息。 <br>
                            备注：目前系统有【一元红包任务，自定义推广任务<!--，清货推广任务-->】，任务可以同时开启。
                            <br>如果关闭发送一元红包任务的话， 必须填写好 此处设置
                            </kbd>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">是否开启发红包功能</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="radio" name="is_open_money" value="0" id="form-oauth-0"  {if $settings['is_open_money'] == 0}checked="true"{/if}  />
                        <label for="form-oauth-0">是</label>
                        <input type="radio" name="is_open_money" value="1" id="form-oauth-1"  {if $settings['is_open_money']==1}checked="true"{/if}  />
                        <label for="form-oauth-1">否</label>
                        <span class="help-block">
                            关闭则表示推广人没有一元红包。
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div id="show_div">
        <div class="panel panel-default">
            <div class="panel-heading">
                发红包的接口参数
            </div>
            <div class="panel-body">

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">AppID</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="appid" value="{$settings['appid']}"   class="form-control">
                        <span class="help-block">就是本公众号的appid</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">AppSecret</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="secret" value="{$settings['secret']}"   class="form-control">
                        <span class="help-block">就是本公众号的AppSecret</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">商户号</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="mchid" value="{$settings['mchid']}" class="form-control">
                        <span class="help-block">微信支付商户号, 开通微信支付才能获得商户号</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">商户支付密钥</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="password" value="{$settings['password']}" class="form-control">
                        <span class="help-block">微信支付商户所使用的支付密钥, 开通微信支付才能获得商户号</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">服务器IP</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="ip" value="{$settings['ip']}" class="form-control">
                        <span class="help-block">发放红包接口需要服务器IP. 程序将自动获取你的服务器IP, 如果获取失败, 请手动指定</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">CERT证书文件</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="file" name="weixin_cert_file" class="form-control" />
                        <span class="help-block">
                            {if !empty($apisec['cert'])}
                            <span class='label label-success'>已上传</span>
                            {else}
                            <span class='label label-danger'>未上传</span>
                            {/if}
                            下载证书 cert.zip 中的 apiclient_cert.pem 文件
                        </span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">支付证书密钥文件</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="file" name="weixin_key_file" class="form-control" />
                            <span class="help-block">
                                {if !empty($apisec['key'])}
                            <span class='label label-success'>已上传</span>
                            {else}
                            <span class='label label-danger'>未上传</span>
                            {/if}
                            下载证书 cert.zip 中的 apiclient_key.pem 文件
                            </span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">支付根证书文件</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="file" name="weixin_root_file" class="form-control" />
                        <span class="help-block">
                          {if !empty($apisec['root'])}
                            <span class='label label-success'>已上传</span>
                            {else}
                            <span class='label label-danger'>未上传</span>
                            {/if}
                            下载证书 cert.zip 中的 rootca.pem 文件
                        </span>
                    </div>
                </div>

            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                红包选项
            </div>
            <div class="panel-body">
                <!--<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">地区定位类型</label>

                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline">
                            <input type="radio" name="locationtype" value="0" {if empty($settings['locationtype'])} checked="checked" {/if}>ip定位</label>
                        <label class="radio-inline">
                            <input type="radio" name="locationtype" value="1"  {if $settings['locationtype']==1} checked="checked" {/if}>gps定位
                        </label>

                        <label class="radio-inline">
                            <input type="radio" name="locationtype" value="2" {if $settings['locationtype']==2} checked="checked" {/if}>粉丝的微信资料</label>

	         			  <span class="help-block">在非wifi网络下，利用ip地址定位地区的话，不准确。利用gps定位更准确，
	         			  不过页面会弹出获取用户地理信息的提示,页面也会出现一点卡顿，地理位置会被人模拟作弊，这无法避免,微信资料就是抓取微信用户填写的地理信息来判断的</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">地区限制</label>

                    <div class="col-xs-12 col-sm-9">
                        <input type="text" name="iplimit" value="{$settings['iplimit']}" class="form-control">
                        <span class="help-block"> 例如:无锡, 如果要多个地区请这样输入:南京,北京,厦门
                                                      只有在符合地区的粉丝才可以生成自己的海报页面.
                                                          ，如果是gps定位，可以支持到区县，比如你们可以直接输入海淀(不要加北京)就可以了，
                                                 如果不符合地区，下面给个自定义链接。
                        </span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">地区不符跳转网页</label>

                    <div class="col-xs-12 col-sm-9">
                        <input type="text" name="zdyurl" value="{$settings['zdyurl']}" class="form-control">
                        <span class="help-block">地址必须是http开头。</span>
                    </div>
                </div>-->

                <div class="form-group sendtype" style="">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><font color='red'>*</font>活动名称</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="act_name" value="{$settings['act_name']}" class="form-control">
                        <span class="help-block">现金红包的活动名称(必填)最多10个汉字 </span>
                    </div>
                </div>

                <div class="form-group sendtype" style="">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><font color='red'>*</font>红包发起人</label>

                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="send_name" value="{$settings['send_name']}" class="form-control">
                        <span class="help-block">发红包人的名称(必填)</span>
                    </div>
                </div>

                <div class="form-group sendtype" style="">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label"><font color='red'>*</font>红包备注</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="remark" value="{$settings['remark']}" class="form-control">
                        <span class="help-block">备注(必填)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包提现金额</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="tx_money" value="{$settings['tx_money']}" class="form-control">
                        <span class="help-block">达到一定金额自动发红包(最低一块钱)</span>
                    </div>
                </div>
                <!--<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">提现方式</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline"><input type="radio" name="tx_type" value="0"
                                                           {if empty($settings['tx_type'])} checked="checked" {/if}>自动提现</label>
                        <label class="radio-inline"><input type="radio" name="tx_type" value="1"
                                                           {if !empty($settings['tx_type'])} checked="checked" {/if}>人工提现</label>
                        <span class="help-block">人工提现直接在后台提现，这样也可以直接删除那些刷红包的疑似粉丝</span>
                    </div>
                </div>-->

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">现金是否存为系统金额表</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline">
                            <input type="radio" name="iscash" value="0"
                                                           {if empty($settings['iscash'])} checked="checked" {/if}>是</label>
                        <label class="radio-inline">
                            <input type="radio" name="iscash" value="1"
                                                           {if !empty($settings['iscash'])} checked="checked" {/if}>否</label>
                        <span class="help-block"></span>
                    </div>
                </div>
               <!--<div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">每天最大领取次数</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="tx_count" value="{$settings['tx_count']}" class="form-control">
                        <span class="help-block"></span>
                    </div>
                </div>-->
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">关注者获得的红包最小金额（元）</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="min_money" value="{$settings['min_money']}" class="form-control">
                        <span class="help-block">拉人关注获得的红包(元为单位)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">关注者获得的红包最大金额（元）</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="max_money" value="{$settings['max_money']}" class="form-control">
                        <span class="help-block">拉人关注获得的红包(元为单位)</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">红包金额变动通知</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="tplid" class="form-control" value="{$settings['tplid']}" />
                        <span class="help-block">IT科技 - 互联网|电子商务. 编号:  OPENTM202220432 , 标题:红包金额变动通知，如果不填写，则使用客服消息发送通知</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">个人最大提现金额</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="person_max_money" value="{$settings['person_max_money']}" class="form-control">
                        <span class="help-block">个人最大提现金额(超过的话，则不能再领取金额)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">发放的总奖金</label>
                    <div class="col-sm-9 col-xs-12">
                        <input type="text" name="total_money" value="{$settings['total_money']}" class="form-control">
                        <span class="help-block">超过则提示奖金已经被领完了，留空则不控制。<kbd>奖金发送完毕后 会以发送积分方式发送</kbd></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                其他选项
            </div>
            <div class="panel-body">
               <!-- <div class="form-group">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">调试模式</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline">
                            <input type="radio" name="debug" value="0" {if empty($settings['debug'])} checked="checked" {/if}>非调试模式</label>
                        <label class="radio-inline">
                            <input type="radio" name="debug" value="1" {if !empty($settings['debug'])} checked="checked" {/if}>调试模式</label>
                        <span class="help-block">如果在调试模式下，可以提示一些错误。看看是否哪里设置错了。上线的时候，可以关掉</span>
                    </div>
                </div>-->
                <div class="form-group" style="display:">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">是否记录金额明细</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline">
                            <input type="radio" name="show_money" value="0"  {if empty($settings['show_money'])} checked="checked" {/if}>否</label>
                        <label class="radio-inline">
                            <input type="radio" name="show_money" value="1"  {if !empty($settings['show_money'])} checked="checked" {/if}>是</label>
                        <span class="help-block">如果选择是的话，就会记录粉丝赚钱明细，副作用就是会让系统响应变慢，如无必要可以取消</span>
                    </div>
                </div>
                <!--<div class="form-group" style="display:">
                    <label class="col-xs-12 col-sm-3 col-md-2 control-label">取消关注是否扣除上级金额</label>
                    <div class="col-xs-12 col-sm-9">
                        <label class="radio-inline">
                            <input type="radio" name="qx_guanzhu" value="0" {if empty($settings['qx_guanzhu'])} checked="checked" {/if}>是</label>
                        <label class="radio-inline">
                            <input type="radio" name="qx_guanzhu" value="1" {if !empty($settings['qx_guanzhu'])} checked="checked" {/if}>否</label>
                        <span class="help-block"></span>
                    </div>
                </div>-->
            </div>

        </div>
        </div>
        <div class="form-group">
            <label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
            <div class="col-md-2 col-lg-1">
                <input name="submit" type="submit" value="保存" class="btn btn-primary btn-block"/>
                <input type="hidden" name="token" value="{$_W['token']}"/>
            </div>
        </div>
    </form>
</div>
<script>

    require(['jquery', 'util'], function ($, u) {
        $(function () {
            $('#theform').submit(function () {
                var message = '';
                var is_open_money= $("input[name='is_open_money']:checked").val();
                if ($.trim(is_open_money) == 0){
                    if ($.trim($(':text[name=appid]').val()) == '') {
                        message += '必须输入AppID<br>';
                    }
                    if ($.trim($(':text[name=secret]').val()) == '') {
                        message += '必须输入AppSecret<br>';
                    }
                    if ($.trim($(':text[name=mchid]').val()) == '') {
                        message += '必须输入微信支付商户号<br>';
                    }
                    if ($.trim($(':text[name=password]').val()) == '') {
                        message += '必须输入微信支付商户密钥<br>';
                    }
                    if (message) {
                        u.message(message);
                        return false;
                    }
                }
                return true;
            });
        });
    });

</script>

